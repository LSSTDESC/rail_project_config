# These are templates for catalogs produced in the early stages of the analysis
Catalogs:
  - CatalogTemplate:
      name: truth
      path_template: "{catalogs_dir}/{project}_{sim_version}/{healpix}/part-0.parquet"
      iteration_vars: ['healpix']
  - CatalogTemplate:
      name: reduced
      path_template: "{catalogs_dir}/{project}_{sim_version}_{selection}/{healpix}/part-0.pq"
      iteration_vars: ['healpix']
  - CatalogTemplate:
      name: degraded
      path_template: "{catalogs_dir}/{project}_{sim_version}_{selection}_{flavor}/{healpix}/{basename}"
      iteration_vars: ['healpix']



# These are templates for specific files, such as testing and training files
Files:
  - FileTemplate:
      name: test_file_100k
      path_template: "{catalogs_dir}/test/{project}_{selection}_baseline_100k.hdf5"
  - FileTemplate:
      name: train_file_100k
      path_template: "{catalogs_dir}/test/{project}_{selection}_baseline_100k.hdf5"
  - FileTemplate:
      name: train_file_zCOSMOS_100k
      path_template: "{catalogs_dir}/train/{project}_{selection}_zCOSMOS_100k.hdf5"
  - FileTemplate:
      name: train_file_HSC_100k
      path_template: "{catalogs_dir}/train/{project}_{selection}_HSC_100k.hdf5"


# These	describe all the algorithms that emulate spectroscopic selections
SpecSelections:
  # - SpecSelection:
  #      name: GAMA:
  #      Select: SpecSelection_GAMA
  #      Module: rail.creation.degraders.spectroscopic_selections
  # - SpecSelection:
  #      name: BOSS
  #      Select: SpecSelection_BOSS
  #      Module: rail.creation.degraders.spectroscopic_selections
  #  - SpecSelection:
  #      name: VVDSf02
  #      Select: SpecSelection_VVDSf02
  #      Module: rail.creation.degraders.spectroscopic_selections
  - SpecSelection:
      name: zCOSMOS
      Select: SpecSelection_zCOSMOS
      Module: rail.creation.degraders.spectroscopic_selections
  - SpecSelection:
      name: HSC
      Select: SpecSelection_HSC
      Module: rail.creation.degraders.spectroscopic_selections


# These describe all the algorithms that estimate PZ
PZAlgorithms:
  - PZAlgorithm:
      name: trainz
      Estimate: TrainZEstimator
      Inform: TrainZInformer
      Module: rail.estimation.algos.train_z
  - PZAlgorithm:
      name: simplenn
      Estimate: SklNeurNetEstimator
      Inform: SklNeurNetInformer
      Module: rail.estimation.algos.sklearn_neurnet
  - PZAlgorithm:
      name: fzboost
      Estimate: FlexZBoostEstimator
      Inform: FlexZBoostInformer
      Module: rail.estimation.algos.flexzboost
  - PZAlgorithm:
      name: knn
      Estimate: KNearNeighEstimator
      Inform: KNearNeighInformer
      Module: rail.estimation.algos.k_nearneigh
  - PZAlgorithm:
      name: gpz
      Estimate: GPzEstimator
      Inform: GPzInformer
      Module: rail.estimation.algos.gpz
  - PZAlgorithm:
      name: bpz
      Estimate: BPZliteEstimator
      Inform: BPZliteInformer
      Module: rail.estimation.algos.bpz_lite
  - PZAlgorithm:
      name: tpz
      Estimate: TPZliteEstimator
      Inform: TPZliteInformer
      Module: rail.estimation.algos.tpz_lite


# These describe the ways we can sub-sample the data
Subsamplers:
  - Subsampler:
      name: random_subsampler
      Subsample: RandomSubsampler
      Module: rail.projects.subsampler


# These describe the ways we can reduce the data
Reducers:
  - Reducer:
      name: roman_rubin
      Reduce: RomanRubinReducer
      Module: rail.projects.reducer


# These describe the selections going from Input to Reduced catalog
Selections:
  - Selection:
      name: gold
      cuts:
        maglim_i: [null, 25.5]
  - Selection:
      name: deep
      cuts:
        maglim_i: [null, 27.0]


# These describe ways to subsampe the data
Subsamples:
  - Subsample:
      name: test_100k
      seed: 1234
      num_objects: 100000
  - Subsample:
      name: train_100k
      seed: 4321
      num_objects: 100000


# These describe the error models we use in the truth_to_observed pipeline
ErrorModels:
  - ErrorModel:
      name: lsst_obs_cond_1yr
      ErrorModel: ObsCondition
      Module: rail.creation.degraders.observing_condition_degrader
      Bands: ['u', 'g', 'r', 'i', 'z', 'y']
      Overrides:
        # also overwrite km if the PhotErr default value differ from LSST specific value
        hdf5_groupname: ''
        mask: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/masks/WFD-mask-nside-128.fits"
        map_dict:
          m5:
            u: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y1/WFD/baseline_v5_1_0_10yrs_ExgalM5_u-band-1-year-wfd_HEAL.fits"
            g: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y1/WFD/baseline_v5_1_0_10yrs_ExgalM5_g-band-1-year-wfd_HEAL.fits"
            r: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y1/WFD/baseline_v5_1_0_10yrs_ExgalM5_r-band-1-year-wfd_HEAL.fits"
            i: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y1/WFD/baseline_v5_1_0_10yrs_ExgalM5_i-band-1-year-wfd_HEAL.fits"
            z: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y1/WFD/baseline_v5_1_0_10yrs_ExgalM5_z-band-1-year-wfd_HEAL.fits"
            y: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y1/WFD/baseline_v5_1_0_10yrs_ExgalM5_y-band-1-year-wfd_HEAL.fits"
          nYrObs: 1.  # do not change this as we use coadd depth map
          nVisYr:  # do not change this as we use coadd depth map
            u: 1.
            g: 1.
            r: 1.
            i: 1.
            z: 1.
            y: 1.
          theta:
            u: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y1/WFD/baseline_v5_1_0_10yrs_Median_seeingFwhmEff_u-band-1-year-wfd_HEAL.fits"
            g: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y1/WFD/baseline_v5_1_0_10yrs_Median_seeingFwhmEff_g-band-1-year-wfd_HEAL.fits"
            r: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y1/WFD/baseline_v5_1_0_10yrs_Median_seeingFwhmEff_r-band-1-year-wfd_HEAL.fits"
            i: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y1/WFD/baseline_v5_1_0_10yrs_Median_seeingFwhmEff_i-band-1-year-wfd_HEAL.fits"
            z: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y1/WFD/baseline_v5_1_0_10yrs_Median_seeingFwhmEff_z-band-1-year-wfd_HEAL.fits"
            y: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y1/WFD/baseline_v5_1_0_10yrs_Median_seeingFwhmEff_y-band-1-year-wfd_HEAL.fits"
          airmass: 0. # do not change this as we use effective theta, which accounts for dependence on airmass
          EBV: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/EBV/ebv-nside-128-gcrs.fits"
          minorCol: minor
          majorCol: major
          extendedType: gaap
          aMin: 1.5  # from Gaap1p0
          highSNR: true  # found to fit the photometric error better at faint end
  - ErrorModel:
      name: lsst_obs_cond_4yr
      ErrorModel: ObsCondition
      Module: rail.creation.degraders.observing_condition_degrader
      Bands: ['u', 'g', 'r', 'i', 'z', 'y']
      Overrides:
        # also overwrite km if the PhotErr default value differ from LSST specific value
        hdf5_groupname: ''
        mask: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/masks/WFD-mask-nside-128.fits"
        map_dict:
          m5:
            u: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y4/WFD/baseline_v5_1_0_10yrs_ExgalM5_u-band-4-year-wfd_HEAL.fits"
            g: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y4/WFD/baseline_v5_1_0_10yrs_ExgalM5_g-band-4-year-wfd_HEAL.fits"
            r: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y4/WFD/baseline_v5_1_0_10yrs_ExgalM5_r-band-4-year-wfd_HEAL.fits"
            i: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y4/WFD/baseline_v5_1_0_10yrs_ExgalM5_i-band-4-year-wfd_HEAL.fits"
            z: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y4/WFD/baseline_v5_1_0_10yrs_ExgalM5_z-band-4-year-wfd_HEAL.fits"
            y: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y4/WFD/baseline_v5_1_0_10yrs_ExgalM5_y-band-4-year-wfd_HEAL.fits"
          nYrObs: 1.  # do not change this as we use coadd depth map
          nVisYr:  # do not change this as we use coadd depth map
            u: 1.
            g: 1.
            r: 1.
            i: 1.
            z: 1.
            y: 1.
          theta:
            u: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y4/WFD/baseline_v5_1_0_10yrs_Median_seeingFwhmEff_u-band-4-year-wfd_HEAL.fits"
            g: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y4/WFD/baseline_v5_1_0_10yrs_Median_seeingFwhmEff_g-band-4-year-wfd_HEAL.fits"
            r: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y4/WFD/baseline_v5_1_0_10yrs_Median_seeingFwhmEff_r-band-4-year-wfd_HEAL.fits"
            i: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y4/WFD/baseline_v5_1_0_10yrs_Median_seeingFwhmEff_i-band-4-year-wfd_HEAL.fits"
            z: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y4/WFD/baseline_v5_1_0_10yrs_Median_seeingFwhmEff_z-band-4-year-wfd_HEAL.fits"
            y: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y4/WFD/baseline_v5_1_0_10yrs_Median_seeingFwhmEff_y-band-4-year-wfd_HEAL.fits"
          airmass: 0. # do not change this as we use effective theta, which accounts for dependence on airmass
          EBV: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/EBV/ebv-nside-128-gcrs.fits"
          minorCol: minor
          majorCol: major
          extendedType: gaap
          aMin: 1.5  # from Gaap1p0
          highSNR: true  # found to fit the photometric error better at faint end
  - ErrorModel:
      name: lsst_obs_cond_10yr
      ErrorModel: ObsCondition
      Module: rail.creation.degraders.observing_condition_degrader
      Bands: ['u', 'g', 'r', 'i', 'z', 'y']
      Overrides:
        # also overwrite km if the PhotErr default value differ from LSST specific value
        hdf5_groupname: ''
        mask: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/masks/WFD-mask-nside-128.fits"
        map_dict:
          m5:
            u: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y10/WFD/baseline_v5_1_0_10yrs_ExgalM5_u-band-10-year-wfd_HEAL.fits"
            g: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y10/WFD/baseline_v5_1_0_10yrs_ExgalM5_g-band-10-year-wfd_HEAL.fits"
            r: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y10/WFD/baseline_v5_1_0_10yrs_ExgalM5_r-band-10-year-wfd_HEAL.fits"
            i: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y10/WFD/baseline_v5_1_0_10yrs_ExgalM5_i-band-10-year-wfd_HEAL.fits"
            z: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y10/WFD/baseline_v5_1_0_10yrs_ExgalM5_z-band-10-year-wfd_HEAL.fits"
            y: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y10/WFD/baseline_v5_1_0_10yrs_ExgalM5_y-band-10-year-wfd_HEAL.fits"
          nYrObs: 1.  # do not change this as we use coadd depth map
          nVisYr:  # do not change this as we use coadd depth map
            u: 1.
            g: 1.
            r: 1.
            i: 1.
            z: 1.
            y: 1.
          theta:
            u: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y10/WFD/baseline_v5_1_0_10yrs_Median_seeingFwhmEff_u-band-10-year-wfd_HEAL.fits"
            g: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y10/WFD/baseline_v5_1_0_10yrs_Median_seeingFwhmEff_g-band-10-year-wfd_HEAL.fits"
            r: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y10/WFD/baseline_v5_1_0_10yrs_Median_seeingFwhmEff_r-band-10-year-wfd_HEAL.fits"
            i: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y10/WFD/baseline_v5_1_0_10yrs_Median_seeingFwhmEff_i-band-10-year-wfd_HEAL.fits"
            z: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y10/WFD/baseline_v5_1_0_10yrs_Median_seeingFwhmEff_z-band-10-year-wfd_HEAL.fits"
            y: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/Y10/WFD/baseline_v5_1_0_10yrs_Median_seeingFwhmEff_y-band-10-year-wfd_HEAL.fits"
          airmass: 0. # do not change this as we use effective theta, which accounts for dependence on airmass
          EBV: "${PZ_DATA_AREA}/survey_conditions/baseline_v5.1_maps/EBV/ebv-nside-128-gcrs.fits"
          minorCol: minor
          majorCol: major
          extendedType: gaap
          aMin: 1.5  # from Gaap1p0
          highSNR: true  # found to fit the photometric error better at faint end
  - ErrorModel:
      name: roman_wide
      ErrorModel: RomanWideErrorModel
      Module: rail.creation.degraders.photometric_errors
  - ErrorModel:
      name: roman_medium
      ErrorModel: RomanMediumErrorModel
      Module: rail.creation.degraders.photometric_errors
  - ErrorModel:
      name: roman_deep
      ErrorModel: RomanDeepErrorModel
      Module: rail.creation.degraders.photometric_errors
  - ErrorModel:
      name: roman_ultradepp
      ErrorModel: RomanUltraDeepErrorModel
      Module: rail.creation.degraders.photometric_errors
  - ErrorModel:
      name: euclid_wide
      ErrorModel: EuclidWideErrorModel
      Module: rail.creation.degraders.photometric_errors
  - ErrorModel:
      name: euclid_deep
      ErrorModel: EuclidDeepErrorModel
      Module: rail.creation.degraders.photometric_errors


# These describe the various data analysis pipelines
Pipelines:
  - PipelineTemplate:
      name: truth_to_observed
      pipeline_class: rail.pipelines.degradation.truth_to_observed.TruthToObservedPipeline
      input_catalog_template: reduced
      output_catalog_template: degraded
      kwargs:
        error_models: ['all']
        selectors: ['all']
        blending: true
  - PipelineTemplate:
      name: photometric_errors
      pipeline_class: rail.pipelines.degradation.apply_phot_errors.ApplyPhotErrorsPipeline
      input_catalog_template: reduced
      output_catalog_template: degraded
      kwargs:
        error_models: ['all']
  - PipelineTemplate:
      name: blending
      input_catalog_template: degraded
      output_catalog_template: degraded
      pipeline_class: rail.pipelines.degradation.blending.BlendingPipeline
      kwargs: {}
  - PipelineTemplate:
      name: spec_selection
      input_catalog_template: degraded
      output_catalog_template: degraded
      pipeline_class: rail.pipelines.degradation.spectroscopic_selection_pipeline.SpectroscopicSelectionPipeline
      kwargs:
        selectors: ['all']
  - PipelineTemplate:
      name: pz
      pipeline_class: rail.pipelines.estimation.pz_all.PzPipeline
      input_catalog_template: degraded
      output_catalog_template: degraded
      input_file_templates:
        input_train:
          flavor: baseline
          tag: train
        input_test:
          flavor: baseline
          tag: test
      kwargs:
        algorithms: ['all']
